name: Deploy to Public Pages Repo

on:
  # ä¸€æœ¬åŒ–ã®ãŸã‚è‡ªå‹•å®Ÿè¡Œã¯åœæ­¢ã€‚å¿…è¦æ™‚ã®ã¿æ‰‹å‹•å®Ÿè¡Œ
  workflow_dispatch:

jobs:
  deploy-to-public:
    runs-on: ubuntu-latest
    # Daily buildãŒæˆåŠŸã—ãŸå ´åˆã®ã¿å®Ÿè¡Œï¼ˆæ‰‹å‹•å®Ÿè¡Œã¯å¸¸ã«å®Ÿè¡Œï¼‰
    if: ${{ github.event_name == 'workflow_dispatch' || github.event.workflow_run.conclusion == 'success' }}
    
    steps:
      - name: Checkout private repo
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Git config
        run: |
          git config --global user.name "GitHub Actions Bot"
          git config --global user.email "actions@github.com"

      - name: Create outputs directory
        run: |
          mkdir -p outputs
          
      - name: Copy built files to outputs
        run: |
          # Enhanced system ã§ç”Ÿæˆã•ã‚Œã‚‹HTMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼
          cp -f index.html outputs/ 2>/dev/null || true
          cp -f news_detail.html outputs/ 2>/dev/null || true
          cp -f ai_news_dashboard.html outputs/ 2>/dev/null || true
          cp -f dashboard.html outputs/ 2>/dev/null || true
          
          # news_detail.html ã‚’ index.html ã¨ã—ã¦ã‚‚ã‚³ãƒ”ãƒ¼ï¼ˆãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã¨ã—ã¦ï¼‰
          [ -f "news_detail.html" ] && cp news_detail.html outputs/index.html || true
          
          # å¿…è¦ãªé™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼ï¼ˆã‚ã‚Œã°ï¼‰
          [ -d "assets" ] && cp -r assets outputs/ || true
          [ -d "css" ] && cp -r css outputs/ || true
          [ -d "js" ] && cp -r js outputs/ || true
          [ -f ".nojekyll" ] && cp .nojekyll outputs/ || true
          
          # ãƒ‡ãƒãƒƒã‚°: outputsãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®å†…å®¹ã‚’ç¢ºèª
          echo "ğŸ“ Contents of outputs directory:"
          ls -la outputs/

      - name: Check if index.html exists
        run: |
          if [ ! -f "outputs/index.html" ]; then
            echo "âš ï¸ Warning: index.html not found in outputs directory"
            echo "Creating placeholder index.html..."
            echo '<!DOCTYPE html><html><head><meta charset="UTF-8"><title>AI News Dashboard</title></head><body><h1>AI News Dashboard - Building...</h1><p>The dashboard is currently being generated. Please check back later.</p></body></html>' > outputs/index.html
          fi

      - name: Deploy to public repository
        uses: peaceiris/actions-gh-pages@v4
        with:
          personal_token: ${{ secrets.PERSONAL_TOKEN }}
          external_repository: awano27/daily-ai-news-pages
          publish_branch: gh-pages
          publish_dir: ./outputs
          user_name: 'github-actions[bot]'
          user_email: 'github-actions[bot]@users.noreply.github.com'
          commit_message: 'Deploy from private repo: ${{ github.sha }}'
          force_orphan: false
          keep_files: false
          enable_jekyll: false

      - name: Verify deployment
        run: |
          echo "âœ… Deployment completed!"
          echo "ğŸ“ Public site will be available at: https://awano27.github.io/daily-ai-news-pages/"
          echo "ğŸ”— Public repository: https://github.com/awano27/daily-ai-news-pages"
